---
import Layout from "../layouts/Layout.astro";

const navItems = [
	{
		key: "1",
		label: "works",
		href: "/works",
		desc: "創作物",
		disabled: false,
	},
	{ key: "2", label: "about", href: "#", desc: "自己紹介", disabled: true },
	{
		key: "3",
		label: "chat",
		href: "/chat",
		desc: "AIと会話",
		disabled: false,
	},
	{ key: "4", label: "setting", href: "#", desc: "設定", disabled: true },
];
---

<Layout title="honjoh.dev" description="Honjoh Nobuhiro - Personal Site">
	<main class="terminal" id="terminal">
		<!-- Scanline overlay -->
		<div class="scanline"></div>

		<!-- Terminal body -->
		<div class="terminal-body">
			<!-- Site title -->
			<h1 class="site-title">honjoh.dev</h1>
			<p class="site-subtitle">Honjoh Nobuhiro</p>

			<!-- Navigation -->
			<nav class="nav-menu" id="nav-menu" aria-label="Site navigation">
				{
					navItems.map((item, idx) => (
						<a
							class={`nav-item ${idx === 0 ? "nav-active" : ""}${item.disabled ? " nav-disabled" : ""}`}
							href={item.href}
							data-idx={idx}
							data-key={item.key}
							data-disabled={item.disabled ? "true" : undefined}
							id={`nav-${idx}`}
						>
							<span class="nav-key">[{item.key}]</span>
							<span class="nav-label">{item.label}</span>
							<span class="nav-desc">{item.desc}</span>
						</a>
					))
				}
			</nav>
		</div>

		<!-- Hint bar -->
		<footer class="hint-bar" id="hint-bar">
			<span class="hint-item"><kbd>↑</kbd><kbd>↓</kbd> 移動</span>
			<span class="hint-sep">│</span>
			<span class="hint-item"><kbd>→</kbd> 決定</span>
			<span class="hint-sep">│</span>
			<span class="hint-item"><kbd>1</kbd>-<kbd>4</kbd> ジャンプ</span>
		</footer>
	</main>
</Layout>

<style>
	/* === Terminal Theme === */
	.terminal {
		position: relative;
		min-height: 100vh;
		background: #0a0e14;
		color: #b3b1ad;
		font-family: "JetBrains Mono", "Consolas", "Monaco", monospace;
		font-size: 14px;
		line-height: 1.6;
		display: flex;
		flex-direction: column;
		overflow: hidden;
	}

	/* Scanline effect */
	.scanline {
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		pointer-events: none;
		z-index: 100;
		background: repeating-linear-gradient(
			0deg,
			transparent,
			transparent 2px,
			rgba(0, 0, 0, 0.03) 2px,
			rgba(0, 0, 0, 0.03) 4px
		);
	}

	/* Terminal body */
	.terminal-body {
		flex: 1;
		display: flex;
		flex-direction: column;
		justify-content: center;
		align-items: center;
		padding: 2rem 3rem;
		max-width: 600px;
		width: 100%;
		margin: 0 auto;
	}

	/* Site title */
	.site-title {
		font-size: clamp(1.8rem, 5vw, 2.4rem);
		font-weight: 700;
		color: #e6e1cf;
		letter-spacing: 0.05em;
		margin-bottom: 0.25rem;
		font-family: inherit;
	}

	.site-subtitle {
		color: #4a5568;
		font-size: 0.85rem;
		margin-bottom: 3rem;
		letter-spacing: 0.1em;
	}

	/* Navigation */
	.nav-menu {
		display: flex;
		flex-direction: column;
		gap: 2px;
		width: 100%;
	}

	.nav-item {
		display: flex;
		align-items: center;
		gap: 12px;
		padding: 10px 16px;
		border-radius: 4px;
		border: 1px solid transparent;
		text-decoration: none;
		color: #b3b1ad;
		transition: all 0.15s ease;
		cursor: pointer;
	}

	.nav-item:hover,
	.nav-item.nav-active {
		background: rgba(57, 186, 230, 0.08);
		border-color: rgba(57, 186, 230, 0.25);
		color: #e6e1cf;
	}

	.nav-item.nav-active {
		border-left: 3px solid #39bae6;
		padding-left: 13px;
	}

	.nav-key {
		color: #ffb454;
		font-weight: 700;
		min-width: 2.5em;
	}

	.nav-label {
		color: #39bae6;
		font-weight: 500;
		min-width: 8em;
	}

	.nav-item.nav-active .nav-label {
		color: #73d0ff;
	}

	.nav-desc {
		color: #4a5568;
		font-size: 12px;
	}

	/* Disabled (coming soon) */
	.nav-item.nav-disabled {
		opacity: 0.35;
		cursor: default;
	}
	.nav-item.nav-disabled:hover,
	.nav-item.nav-disabled.nav-active {
		background: rgba(57, 186, 230, 0.03);
		border-color: rgba(57, 186, 230, 0.1);
	}

	/* Hint bar */
	.hint-bar {
		display: flex;
		align-items: center;
		justify-content: center;
		gap: 16px;
		padding: 10px 16px;
		background: #1a1f29;
		border-top: 1px solid #2a2f3a;
		font-size: 12px;
		color: #4a5568;
		flex-shrink: 0;
		user-select: none;
	}

	.hint-item {
		display: flex;
		align-items: center;
		gap: 4px;
	}

	.hint-sep {
		color: #2a2f3a;
	}

	kbd {
		display: inline-block;
		padding: 1px 6px;
		background: #2a2f3a;
		border: 1px solid #3a3f4a;
		border-radius: 3px;
		color: #b3b1ad;
		font-family: inherit;
		font-size: 11px;
		line-height: 1.4;
	}

	/* Responsive */
	@media (max-width: 640px) {
		.terminal-body {
			padding: 1.5rem 1rem;
		}
		.nav-desc {
			display: none;
		}
		.hint-bar {
			gap: 10px;
			font-size: 11px;
		}
	}

	/* Vignette */
	.terminal::after {
		content: "";
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		pointer-events: none;
		z-index: 99;
		background: radial-gradient(
			ellipse at center,
			transparent 50%,
			rgba(0, 0, 0, 0.4) 100%
		);
	}
</style>

<script>
	const navItems = document.querySelectorAll<HTMLAnchorElement>(".nav-item");
	let activeIdx = 0;

	function setActive(idx: number) {
		if (idx < 0 || idx >= navItems.length) return;
		navItems[activeIdx].classList.remove("nav-active");
		activeIdx = idx;
		navItems[activeIdx].classList.add("nav-active");
		navItems[activeIdx].focus({ preventScroll: true });
	}

	function navigate() {
		if (navItems[activeIdx].dataset.disabled === "true") return;
		const href = navItems[activeIdx].getAttribute("href");
		if (href && href !== "#") {
			window.location.href = href;
		}
	}

	// Keyboard navigation
	document.addEventListener("keydown", (e: KeyboardEvent) => {
		const tag = (e.target as HTMLElement).tagName;
		if (tag === "INPUT" || tag === "TEXTAREA" || tag === "SELECT") return;
		if (e.ctrlKey || e.altKey || e.metaKey) return;

		switch (e.key) {
			case "ArrowDown":
			case "j":
				e.preventDefault();
				setActive(activeIdx < navItems.length - 1 ? activeIdx + 1 : 0);
				break;
			case "ArrowUp":
			case "k":
				e.preventDefault();
				setActive(activeIdx > 0 ? activeIdx - 1 : navItems.length - 1);
				break;
			case "ArrowRight":
			case "Enter":
				e.preventDefault();
				navigate();
				break;
			case "1":
			case "2":
			case "3":
			case "4":
				const idx = parseInt(e.key) - 1;
				if (idx < navItems.length) {
					e.preventDefault();
					setActive(idx);
					navigate();
				}
				break;
		}
	});

	// Mouse hover activation
	navItems.forEach((item, idx) => {
		item.addEventListener("mouseenter", () => {
			navItems[activeIdx].classList.remove("nav-active");
			activeIdx = idx;
			item.classList.add("nav-active");
		});
	});
</script>
